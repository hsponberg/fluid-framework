//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: src-delomboked/com/sponberg/app/ui/SearchWhere.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/sponberg/app/SampleApp.h"
#include "com/sponberg/app/datastore/DS.h"
#include "com/sponberg/app/datastore/postcodes/DSPostcode.h"
#include "com/sponberg/app/domain/Postcode.h"
#include "com/sponberg/app/form/SignupForm.h"
#include "com/sponberg/app/ui/Screen.h"
#include "com/sponberg/app/ui/SearchWhere.h"
#include "com/sponberg/fluid/FluidApp.h"
#include "com/sponberg/fluid/GlobalState.h"
#include "com/sponberg/fluid/Platforms.h"
#include "com/sponberg/fluid/datastore/DatastoreTransaction.h"
#include "com/sponberg/fluid/datastore/SQLResultList.h"
#include "com/sponberg/fluid/layout/ActionListener.h"
#include "com/sponberg/fluid/layout/DataModelManager.h"
#include "com/sponberg/fluid/layout/TableList.h"
#include "com/sponberg/fluid/layout/UIService.h"
#include "com/sponberg/fluid/util/Logger.h"
#include "java/lang/Character.h"
#include "java/lang/Long.h"
#include "java/lang/StringBuilder.h"

@implementation FASearchWhere

- (void)load__WithFFTFluidApp:(FFTFluidApp *)fApp {
  self->app_ = (FASampleApp *) check_class_cast(fApp, [FASampleApp class]);
  (void) [((FFTFluidApp_AddActionListenerBuilder *) nil_chk([((FASampleApp *) nil_chk(app_)) addActionListenerWithNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ FAScreen_get_SearchWhere_(), FAScreen_ScreenSearchWhere_get_Search_() } count:2 type:[IOSClass classWithClass:[NSString class]]]])) listenerWithFFTActionListener:[[FASearchWhere_$1 alloc] initWithFASearchWhere:self]];
  (void) [((FFTFluidApp_AddActionListenerBuilder *) nil_chk([app_ addActionListenerWithNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ FAScreen_get_SearchWhere_(), FAScreen_ScreenSearchWhere_get_Results_() } count:2 type:[IOSClass classWithClass:[NSString class]]]])) listenerWithFFTActionListener:[[FASearchWhere_$2 alloc] initWithFASearchWhere:self]];
  [app_ addScreenListenerWithNSString:FAScreen_get_SearchWhere_() withFFTScreenListener:[[FASearchWhere_$3 alloc] initWithFASearchWhere:self]];
}

- (void)userTappedSearchResultWithId:(id)userInfo {
  JavaLangLong *id_ = (JavaLangLong *) check_class_cast(userInfo, [JavaLangLong class]);
  FAPostcode *suburb = [((FFTTableList *) nil_chk([((FASignupForm *) nil_chk([((FASampleApp *) nil_chk(app_)) getQuoteForm])) getWhereSearchResults])) getByIdWithJavaLangLong:id_];
  [((FASignupForm *) nil_chk([app_ getQuoteForm])) setWhereWithFAPostcode:suburb];
  [((FASignupForm *) nil_chk([app_ getQuoteForm])) setWhereSearchResultsWithFFTTableList:[[FFTTableList alloc] init]];
  [((FFTDataModelManager *) nil_chk([app_ getDataModelManager])) dataDidChangeWithNSString:@"app.quoteForm.where" withNSStringArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSString class]]]];
  [((id<FFTUIService>) nil_chk([((FFTFluidApp *) nil_chk(FFTGlobalState_get_fluidApp__())) getUiService])) popLayout];
}

- (void)userSearchedForWithId:(id)value {
  NSString *search = [nil_chk(value) description];
  if (((int) [((NSString *) nil_chk(search)) length]) < 2) {
    [((FASignupForm *) nil_chk([((FASampleApp *) nil_chk(app_)) getQuoteForm])) setWhereSearchResultsWithFFTTableList:[[FFTTableList alloc] init]];
    [((FFTDataModelManager *) nil_chk([app_ getDataModelManager])) dataDidChangeWithNSString:@"app.quoteForm.whereSearchResults" withNSStringArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSString class]]]];
    return;
  }
  IOSObjectArray *searchTerms = [search split:@" "];
  BOOL firstIsDigit = [JavaLangCharacter isDigitWithChar:[((NSString *) IOSObjectArray_Get(nil_chk(searchTerms), 0)) charAtWithInt:0]];
  NSString *codeSearch = nil;
  NSString *titleSearch = nil;
  int startTitleSearchAt = 0;
  if (firstIsDigit) {
    codeSearch = IOSObjectArray_Get(searchTerms, 0);
    startTitleSearchAt = ((int) [((NSString *) nil_chk(codeSearch)) length]) + 1;
  }
  if (startTitleSearchAt < ((int) [search length])) {
    titleSearch = [search substring:startTitleSearchAt];
    if ([((NSString *) nil_chk(titleSearch)) hasPrefix:@"- "]) {
      titleSearch = [titleSearch substring:2];
    }
    else if ([titleSearch hasPrefix:@"-"]) {
      titleSearch = [titleSearch substring:1];
    }
  }
  FFTDatastoreTransaction *txn = [[FFTDatastoreTransaction alloc] initWithNSString:FADS_get_postcodes_()];
  [txn start];
  FFTTableList *list = [[FFTTableList alloc] init];
  FFTDatastoreTransaction_QueryBuilder *query = [((FFTDatastoreTransaction_QueryBuilder *) nil_chk([((FFTDatastoreTransaction_QueryBuilder *) nil_chk([((FFTDatastoreTransaction_QueryBuilder *) nil_chk([txn queryWithIOSClass:[IOSClass classWithClass:[FAPostcode class]]])) selectWithNSStringArray:[IOSObjectArray arrayWithObjects:(id[]){ ComSponbergAppDatastorePostcodesDSPostcode_get_id__(), ComSponbergAppDatastorePostcodesDSPostcode_get_code_(), ComSponbergAppDatastorePostcodesDSPostcode_get_title_() } count:3 type:[IOSClass classWithClass:[NSString class]]]])) limitWithInt:2000])) allowRefreshWithBoolean:NO];
  JavaLangStringBuilder *where = [[JavaLangStringBuilder alloc] init];
  if (codeSearch != nil) {
    (void) [where appendWithNSString:@"{} like ?"];
    query = [((FFTDatastoreTransaction_QueryBuilder *) nil_chk(query)) paramWithNSString:ComSponbergAppDatastorePostcodesDSPostcode_get_code_() withId:[NSString stringWithFormat:@"%@%%", codeSearch]];
  }
  if (titleSearch != nil && ![titleSearch isEqual:@""]) {
    if (codeSearch != nil) {
      (void) [where appendWithNSString:@" and "];
    }
    (void) [where appendWithNSString:@"{} like ?"];
    query = [((FFTDatastoreTransaction_QueryBuilder *) nil_chk(query)) paramWithNSString:ComSponbergAppDatastorePostcodesDSPostcode_get_title_() withId:[NSString stringWithFormat:@"%@%%", titleSearch]];
  }
  query = [((FFTDatastoreTransaction_QueryBuilder *) nil_chk(query)) whereWithNSString:[where description]];
  for (FAPostcode * __strong suburb in nil_chk([((FFTDatastoreTransaction_QueryBuilder *) nil_chk(query)) execute])) {
    [list addWithId:suburb];
  }
  BOOL digit = [JavaLangCharacter isDigitWithChar:[search charAtWithInt:0]];
  [list sortWithJavaUtilComparator:[[FASearchWhere_$4 alloc] initWithBoolean:digit]];
  [FFTLogger debugWithId:self withNSString:[NSString stringWithFormat:@"result size is %d", [list size]] withNSObjectArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSObject class]]]];
  [((FASignupForm *) nil_chk([((FASampleApp *) nil_chk(app_)) getQuoteForm])) setWhereSearchResultsWithFFTTableList:list];
  [((FFTDataModelManager *) nil_chk([app_ getDataModelManager])) dataDidChangeWithNSString:@"app.quoteForm.whereSearchResults" withNSStringArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSString class]]]];
  [txn rollback];
}

- (void)userCanceledSearch {
  [((FASignupForm *) nil_chk([((FASampleApp *) nil_chk(app_)) getQuoteForm])) setWhereSearchResultsWithFFTTableList:[[FFTTableList alloc] init]];
  [((id<FFTUIService>) nil_chk([((FFTFluidApp *) nil_chk(FFTGlobalState_get_fluidApp__())) getUiService])) popLayout];
}

- (IOSObjectArray *)getSupportedPlatforms {
  return [IOSObjectArray arrayWithObjects:(id[]){ FFTPlatforms_get_IOS_() } count:1 type:[IOSClass classWithClass:[NSString class]]];
}

- (id)init {
  return [super init];
}

- (void)copyAllFieldsTo:(FASearchWhere *)other {
  [super copyAllFieldsTo:other];
  other->app_ = app_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "load__WithFFTFluidApp:", "load", "V", 0x1, NULL },
    { "userTappedSearchResultWithId:", "userTappedSearchResult", "V", 0x4, NULL },
    { "userSearchedForWithId:", "userSearchedFor", "V", 0x4, NULL },
    { "userCanceledSearch", NULL, "V", 0x4, NULL },
    { "getSupportedPlatforms", NULL, "[Ljava.lang.String;", 0x1, NULL },
    { "init", NULL, NULL, 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "app_", NULL, 0x0, "Lcom.sponberg.app.SampleApp;", NULL,  },
  };
  static J2ObjcClassInfo _FASearchWhere = { "SearchWhere", "com.sponberg.app.ui", NULL, 0x1, 6, methods, 1, fields, 0, NULL};
  return &_FASearchWhere;
}

@end

@implementation FASearchWhere_$1

- (void)userChangedValueToWithFFTActionListener_EventInfo:(FFTActionListener_EventInfo *)info
                                                   withId:(id)value {
  [this$0_ userSearchedForWithId:value];
}

- (void)userCancelled {
  [this$0_ userCanceledSearch];
}

- (id)initWithFASearchWhere:(FASearchWhere *)outer$ {
  this$0_ = outer$;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "userChangedValueToWithFFTActionListener_EventInfo:withId:", "userChangedValueTo", "V", 0x1, NULL },
    { "userCancelled", NULL, "V", 0x1, NULL },
    { "initWithFASearchWhere:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.sponberg.app.ui.SearchWhere;", NULL,  },
  };
  static J2ObjcClassInfo _FASearchWhere_$1 = { "$1", "com.sponberg.app.ui", "SearchWhere", 0x8000, 3, methods, 1, fields, 0, NULL};
  return &_FASearchWhere_$1;
}

@end

@implementation FASearchWhere_$2

- (void)userTappedWithFFTActionListener_EventInfo:(FFTActionListener_EventInfo *)info {
  [this$0_ userTappedSearchResultWithId:[((FFTActionListener_EventInfo *) nil_chk(info)) getUserInfo]];
}

- (id)initWithFASearchWhere:(FASearchWhere *)outer$ {
  this$0_ = outer$;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "userTappedWithFFTActionListener_EventInfo:", "userTapped", "V", 0x1, NULL },
    { "initWithFASearchWhere:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.sponberg.app.ui.SearchWhere;", NULL,  },
  };
  static J2ObjcClassInfo _FASearchWhere_$2 = { "$2", "com.sponberg.app.ui", "SearchWhere", 0x8000, 2, methods, 1, fields, 0, NULL};
  return &_FASearchWhere_$2;
}

@end

@implementation FASearchWhere_$3

- (void)screenWillAppear {
}

- (void)screenDidDisappear {
  [((FASignupForm *) nil_chk([((FASampleApp *) nil_chk(this$0_->app_)) getQuoteForm])) setWhereSearchResultsWithFFTTableList:[[FFTTableList alloc] init]];
}

- (void)screenDidAppear {
}

- (void)screenWasRemoved {
}

- (id)initWithFASearchWhere:(FASearchWhere *)outer$ {
  this$0_ = outer$;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "screenWillAppear", NULL, "V", 0x1, NULL },
    { "screenDidDisappear", NULL, "V", 0x1, NULL },
    { "screenDidAppear", NULL, "V", 0x1, NULL },
    { "screenWasRemoved", NULL, "V", 0x1, NULL },
    { "initWithFASearchWhere:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.sponberg.app.ui.SearchWhere;", NULL,  },
  };
  static J2ObjcClassInfo _FASearchWhere_$3 = { "$3", "com.sponberg.app.ui", "SearchWhere", 0x8000, 5, methods, 1, fields, 0, NULL};
  return &_FASearchWhere_$3;
}

@end

@implementation FASearchWhere_$4

- (int)compareWithId:(FAPostcode *)o1
              withId:(FAPostcode *)o2 {
  if (val$digit_) {
    return [((NSString *) nil_chk([((FAPostcode *) nil_chk(o1)) getCode])) compareToWithId:[((FAPostcode *) nil_chk(o2)) getCode]];
  }
  else {
    return [((NSString *) nil_chk([((FAPostcode *) nil_chk(o1)) getTitle])) compareToWithId:[((FAPostcode *) nil_chk(o2)) getTitle]];
  }
}

- (id)initWithBoolean:(BOOL)capture$0 {
  val$digit_ = capture$0;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "compareWithFAPostcode:withFAPostcode:", "compare", "I", 0x1, NULL },
    { "initWithBoolean:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "val$digit_", NULL, 0x1012, "Z", NULL,  },
  };
  static J2ObjcClassInfo _FASearchWhere_$4 = { "$4", "com.sponberg.app.ui", "SearchWhere", 0x8000, 2, methods, 1, fields, 0, NULL};
  return &_FASearchWhere_$4;
}

@end
