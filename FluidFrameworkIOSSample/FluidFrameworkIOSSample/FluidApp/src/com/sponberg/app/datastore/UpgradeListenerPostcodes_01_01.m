//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: src-delomboked/com/sponberg/app/datastore/UpgradeListenerPostcodes_01_01.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/sponberg/app/datastore/DS.h"
#include "com/sponberg/app/datastore/UpgradeListenerPostcodes_01_01.h"
#include "com/sponberg/app/datastore/postcodes/DSPostcode.h"
#include "com/sponberg/fluid/FluidApp.h"
#include "com/sponberg/fluid/GlobalState.h"
#include "com/sponberg/fluid/ResourceService.h"
#include "com/sponberg/fluid/datastore/DatastoreException.h"
#include "com/sponberg/fluid/datastore/DatastoreTransaction.h"
#include "com/sponberg/fluid/datastore/DatastoreVersion.h"
#include "com/sponberg/fluid/util/CsvReader.h"
#include "com/sponberg/fluid/util/Logger.h"
#include "java/io/BufferedReader.h"
#include "java/io/IOException.h"
#include "java/io/StringReader.h"
#include "java/lang/Integer.h"
#include "java/lang/Long.h"
#include "java/util/ArrayList.h"

@implementation FAUpgradeListenerPostcodes_01_01

NSString * FAUpgradeListenerPostcodes_01_01_datastoreName_ = @"postcodes";

- (BOOL)databaseWasUpgradedWithFFTDatastoreVersion:(FFTDatastoreVersion *)version_ {
  NSString *csv = [((id<FFTResourceService>) nil_chk([((FFTFluidApp *) nil_chk(FFTGlobalState_get_fluidApp__())) getResourceService])) getResourceAsStringWithNSString:@"csv" withNSString:@"postcodes.csv"];
  FFTCsvReader *suburbs;
  @try {
    suburbs = [[FFTCsvReader alloc] initWithJavaIoBufferedReader:[[JavaIoBufferedReader alloc] initWithJavaIoReader:[[JavaIoStringReader alloc] initWithNSString:csv]] withChar:','];
  }
  @catch (JavaIoIOException *e) {
    [FFTLogger errorWithId:self withJavaLangThrowable:e];
    return NO;
  }
  FFTDatastoreTransaction *txn = [[FFTDatastoreTransaction alloc] initWithNSString:FADS_get_postcodes_()];
  [txn start];
  for (FFTCsvReader_Row * __strong row in nil_chk([((FFTCsvReader *) nil_chk(suburbs)) getRows])) {
    ComSponbergAppDatastorePostcodesDSPostcode *postcode = [[ComSponbergAppDatastorePostcodesDSPostcode alloc] init];
    [postcode setIdWithJavaLangInteger:[JavaLangInteger valueOfWithInt:[JavaLangInteger parseIntWithNSString:[((FFTCsvReader_Row *) nil_chk(row)) getWithNSString:@"id"]]]];
    [postcode setCodeWithNSString:[row getWithNSString:@"code"]];
    [postcode setTitleWithNSString:[row getWithNSString:@"title"]];
    (void) [txn insertWithId:postcode];
  }
  [txn commit];
  [FFTLogger debugWithId:self withNSString:@" Upgrading postcodes to 1.1, inserted postcodes from csv" withNSObjectArray:[IOSObjectArray arrayWithLength:0 type:[IOSClass classWithClass:[NSObject class]]]];
  return YES;
}

- (NSString *)getDatastoreName {
  return FAUpgradeListenerPostcodes_01_01_datastoreName_;
}

- (id)init {
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "databaseWasUpgradedWithFFTDatastoreVersion:", "databaseWasUpgraded", "Z", 0x1, "Lcom.sponberg.fluid.datastore.DatastoreException;" },
    { "getDatastoreName", NULL, "Ljava.lang.String;", 0x1, NULL },
    { "init", NULL, NULL, 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "datastoreName_", NULL, 0x18, "Ljava.lang.String;", &FAUpgradeListenerPostcodes_01_01_datastoreName_,  },
  };
  static J2ObjcClassInfo _FAUpgradeListenerPostcodes_01_01 = { "UpgradeListenerPostcodes_01_01", "com.sponberg.app.datastore", NULL, 0x1, 3, methods, 1, fields, 0, NULL};
  return &_FAUpgradeListenerPostcodes_01_01;
}

@end
